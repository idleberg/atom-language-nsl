'use strict';var atom$1=require('atom'),atomSatisfyDependencies=require('atom-satisfy-dependencies'),child_process=require('child_process'),promises=require('fs/promises');var n={name:"language-nsl"};async function l(){let e=atom.config.get(`${n.name}.pathToJar`);if(await y(e))return;let t=atom.notifications.addWarning(`**${n.name}**: No valid \`nsL.jar\` was specified in your settings`,{dismissable:true,buttons:[{text:"Open Settings",className:"icon icon-gear",onDidClick(){atom.workspace.open(`atom://config/packages/${n.name}`,{pending:true,searchAllPanes:true}),t.dismiss();}},{text:"Ignore",onDidClick(){atom.config.set(`${n.name}.mutePathWarning`,true),t.dismiss();}}]});}function c(){if(atom.config.get(`${n.name}.showBuildNotifications`)===false)return;let e=atom.notifications.addSuccess("Transpiled successfully",{dismissable:true,buttons:[{text:"Open",className:"icon icon-pencil",onDidClick(){b(),e.dismiss();}},{text:"Cancel",onDidClick(){e.dismiss();}}]});}function b(){var o;let e=(o=atom.workspace.getActiveTextEditor())==null?void 0:o.getPath();if(!e)return;let t=e.replace(/\.nsl$/,".nsi");atom.workspace.open(t);}async function y(e){try{await promises.access(e,promises.constants.F_OK);}catch{return  false}return  true}function u(e){let t=atom.workspace.getActiveTextEditor();if(t==null){atom.notifications.addWarning(`**${n.name}**: No active editor`,{dismissable:false});return}let o=t.getPath(),m=t.getGrammar().scopeName;o!=null&&m.startsWith("source.nsl")?t.save().then(()=>{let p=["-jar",`${atom.config.get("language-nsl.pathToJar")}`],i=[...atom.config.get("language-nsl.customArguments")];i.push(o);let d=p.concat(i);try{e.clear();}catch{atom.config.get("language-nsl.clearConsole")&&console.clear();}let a=child_process.spawn("java",d),r=false;a.stdout.on("data",s=>{try{atom.config.get("language-nsl.alwaysShowOutput")&&e.log(s.toString());}catch{console.log(s.toString());}}),a.stderr.on("data",s=>{r=true;try{e.error(s.toString());}catch{console.error(s.toString());}}),a.on("close",s=>{s===0&&r===false?atom.config.get("language-nsl.showBuildNotifications")&&c():atom.config.get("language-nsl.showBuildNotifications")&&atom.notifications.addError("Transpile failed",{dismissable:false});});}):atom.beep();}var S={pathToJar:{title:"Path To JAR",description:"Specify the full path to `nsL.jar`",type:"string",default:"",order:0},mutePathWarning:{title:"Mute Path Warning",description:"When enabled, warnings about missing path to `nsL.jar` will be muted",type:"boolean",default:false,order:1},customArguments:{title:"Custom Arguments",description:"Specify your preferred arguments for nsL Assembler, separated by commas",type:"array",default:["/nomake","/nopause"],items:{type:"string"},order:2},alwaysShowOutput:{title:"Always Show Output",description:"Displays compiler output in console panel. When deactivated, it will only show on errors",type:"boolean",default:true,order:3},showBuildNotifications:{title:"Show Build Notifications",description:"Displays color-coded notifications that close automatically after 5 seconds",type:"boolean",default:true,order:4},clearConsole:{title:"Clear Console",description:"When `console-panel` isn't available, build logs will be printed using `console.log()`. This setting clears the console prior to building.",type:"boolean",default:true,order:5},manageDependencies:{title:"Manage Dependencies",description:"When enabled, third-party dependencies will be installed automatically",type:"boolean",default:true,order:6}},j={config:S,subscriptions:null,consolePanel:void 0,async activate(){this.subscriptions=new atom$1.CompositeDisposable,this.subscriptions.add(atom.commands.add("atom-workspace",{"nsl-assembler:save-&-transpile":()=>u(this.consolePanel)})),atom.config.get("language-nsl.manageDependencies")===true&&atomSatisfyDependencies.satisfyDependencies("language-nsl"),atom.config.get("language-nsl.mutePathWarning")===false&&await l();},deactivate(){this.subscriptions!=null&&this.subscriptions.dispose(),this.subscriptions=null;},consumeConsolePanel(e){this.consolePanel=e;}};
module.exports=j;