'use strict';var atom$1=require('atom'),fs=require('fs'),path=require('path'),atomSatisfyDependencies=require('atom-satisfy-dependencies'),child_process=require('child_process');var n={name:"language-nsl"};function d(){let e=atom.config.get(`${n.name}.pathToJar`);fs.access(e,fs.constants.R_OK|fs.constants.W_OK,t=>{if(t){let o=atom.notifications.addWarning(`**${n.name}**: No valid \`nsL.jar\` was specified in your settings`,{dismissable:true,buttons:[{text:"Open Settings",className:"icon icon-gear",onDidClick(){atom.workspace.open(`atom://config/packages/${n.name}`,{pending:true,searchAllPanes:true}),o.dismiss();}},{text:"Ignore",onDidClick(){atom.config.set(`${n.name}.mutePathWarning`,true),o.dismiss();}}]});}});}function g(){if(atom.config.get(`${n.name}.showBuildNotifications`)){let e=atom.notifications.addSuccess("Transpiled successfully",{dismissable:true,buttons:[{text:"Open",className:"icon icon-pencil",onDidClick(){P(),e.dismiss();}},{text:"Cancel",onDidClick(){e.dismiss();}}]});}}function P(){var i,l,a;let e=(a=(l=(i=atom.workspace.getActiveTextEditor())==null?void 0:i.buffer)==null?void 0:l.file)==null?void 0:a.path;if(!e)return;let t=path.dirname(e),o=path.extname(e),m=path.basename(e,o)+".nsi",r=path.join(t,m);atom.workspace.open(r);}function f(e){let t=atom.workspace.getActiveTextEditor();if(t==null){atom.notifications.addWarning(`**${n.name}**: No active editor`,{dismissable:false});return}let o=t.getPath(),c=t.getGrammar().scopeName;o!=null&&c.startsWith("source.nsl")?t.save().then(()=>{let r=["-jar",`${atom.config.get("language-nsl.pathToJar")}`],i=[...atom.config.get("language-nsl.customArguments")];i.push(o);let l=r.concat(i);try{e.clear();}catch{atom.config.get("language-nsl.clearConsole")&&console.clear();}let a=child_process.spawn("java",l),u=false;a.stdout.on("data",s=>{try{atom.config.get("language-nsl.alwaysShowOutput")&&e.log(s.toString());}catch{console.log(s.toString());}}),a.stderr.on("data",s=>{u=true;try{e.error(s.toString());}catch{console.error(s.toString());}}),a.on("close",s=>{s===0&&u===false?atom.config.get("language-nsl.showBuildNotifications")&&g():atom.config.get("language-nsl.showBuildNotifications")&&atom.notifications.addError("Transpile failed",{dismissable:false});});}):atom.beep();}var A={pathToJar:{title:"Path To JAR",description:"Specify the full path to `nsL.jar`",type:"string",default:"",order:0},mutePathWarning:{title:"Mute Path Warning",description:"When enabled, warnings about missing path to `nsL.jar` will be muted",type:"boolean",default:false,order:1},customArguments:{title:"Custom Arguments",description:"Specify your preferred arguments for nsL Assembler, separated by commas",type:"array",default:["/nomake","/nopause"],items:{type:"string"},order:2},alwaysShowOutput:{title:"Always Show Output",description:"Displays compiler output in console panel. When deactivated, it will only show on errors",type:"boolean",default:true,order:3},showBuildNotifications:{title:"Show Build Notifications",description:"Displays color-coded notifications that close automatically after 5 seconds",type:"boolean",default:true,order:4},clearConsole:{title:"Clear Console",description:"When `console-panel` isn't available, build logs will be printed using `console.log()`. This setting clears the console prior to building.",type:"boolean",default:true,order:5},manageDependencies:{title:"Manage Dependencies",description:"When enabled, third-party dependencies will be installed automatically",type:"boolean",default:true,order:6}},D={config:A,subscriptions:null,consolePanel:void 0,activate(){this.subscriptions=new atom$1.CompositeDisposable,this.subscriptions.add(atom.commands.add("atom-workspace",{"nsl-assembler:save-&-transpile":()=>f(this.consolePanel)})),atom.config.get("language-nsl.manageDependencies")===true&&atomSatisfyDependencies.satisfyDependencies("language-nsl"),atom.config.get("language-nsl.mutePathWarning")===false&&d();},deactivate(){this.subscriptions!=null&&this.subscriptions.dispose(),this.subscriptions=null;},consumeConsolePanel(e){this.consolePanel=e;}},K=D;
module.exports=K;